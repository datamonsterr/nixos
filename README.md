# NixOS Configuration with Multiple Hosts

This repository contains a modular NixOS configuration supporting multiple devices (laptop and PC) using Nix flakes and Home Manager.

## Structure

```
.
├── flake.nix                 # Main flake configuration
├── flake.lock               # Lock file for reproducible builds
├── hosts/                   # Host-specific configurations
│   ├── laptop/
│   │   ├── default.nix      # Laptop-specific system config
│   │   └── hardware-configuration.nix  # Generated by nixos-generate-config
│   └── pc/
│       ├── default.nix      # PC-specific system config
│       └── hardware-configuration.nix  # Generated by nixos-generate-config
├── modules/                 # Reusable NixOS modules
│   ├── common.nix          # Common system configuration
│   ├── desktop-i3.nix      # Desktop environment (i3wm)
│   ├── laptop.nix          # Laptop-specific features (TLP, touchpad, WiFi)
│   └── server.nix          # Server/headless configuration
├── home/                   # Home Manager configurations
│   ├── common.nix          # Common user configuration
│   └── users/
│       ├── dat-laptop.nix  # User config for laptop (with HiDPI scaling)
│       └── dat-pc.nix      # User config for PC (standard scaling)
└── assets/                 # Configuration files and assets
    ├── backgrounds/        # Wallpapers
    ├── config/            # Original config files
    ├── config-laptop/     # Laptop-specific configs (HiDPI)
    ├── config-pc/         # PC-specific configs (standard)
    └── script/            # Utility scripts
```

## Device Differences

### Laptop Configuration
- **Display**: HiDPI scaling enabled (1.4x scale factor)
- **Power Management**: TLP enabled for battery optimization
- **Hardware**: WiFi, Bluetooth, touchpad, brightness control
- **Services**: Thermal management, battery monitoring

### PC Configuration
- **Display**: Standard scaling (1x scale factor)
- **Power Management**: No TLP, performance-focused
- **Hardware**: Ethernet preferred, Bluetooth for peripherals, no touchpad
- **Services**: Hardware monitoring tools, stress testing utilities

## Usage

### Building for Laptop
```bash
sudo nixos-rebuild switch --flake /etc/nixos#laptop
```

### Building for PC
```bash
sudo nixos-rebuild switch --flake /etc/nixos#pc
```

## Setting up a New Host

### For PC Setup:
1. Install NixOS on your PC hardware
2. Generate hardware configuration:
   ```bash
   sudo nixos-generate-config --root /mnt --dir /etc/nixos/hosts/pc
   ```
3. Replace the placeholder `hardware-configuration.nix` with the generated one
4. Update `/etc/nixos/hosts/pc/hardware-configuration.nix` with actual UUIDs and hardware details
5. Build the configuration:
   ```bash
   sudo nixos-rebuild switch --flake /etc/nixos#pc
   ```

### Customization

#### Display Scaling
- **Laptop**: Modify scaling factors in `/etc/nixos/hosts/laptop/default.nix`
- **PC**: Standard scaling in `/etc/nixos/hosts/pc/default.nix`

#### Device-Specific Configs
- **Laptop configs**: `/etc/nixos/assets/config-laptop/`
- **PC configs**: `/etc/nixos/assets/config-pc/`

#### Adding New Hosts
1. Create new directory in `hosts/`
2. Add `default.nix` and `hardware-configuration.nix`
3. Create corresponding home configuration in `home/users/`
4. Update `flake.nix` to include the new host
5. Create device-specific config directory in `assets/`

## Modules Overview

- **common.nix**: Base system configuration (networking, users, packages)
- **desktop-i3.nix**: i3 window manager and desktop environment
- **laptop.nix**: Laptop-specific features (power management, hardware support)
- **server.nix**: Headless/server configuration

## Home Manager

Home Manager is integrated as a NixOS module and manages:
- User-specific packages and configurations
- Dotfiles and application configs
- Device-specific scaling and environment variables
- Desktop-specific applications and tools

## Migration Notes

This setup migrates from a single-host configuration to a multi-host setup while maintaining backward compatibility through the `nixos` host alias.
