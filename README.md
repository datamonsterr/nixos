# NixOS Configuration with Multiple Hosts

This repository contains a modular NixOS configuration supporting multiple devices (laptop and PC) using Nix flakes and Home Manager.

## Structure

```
.
├── flake.nix                 # Main flake configuration
├── flake.lock               # Lock file for reproducible builds
├── hosts/                   # Host-specific configurations
│   ├── laptop/
│   │   ├── default.nix      # Laptop-specific system config
│   │   └── hardware-configuration.nix  # Generated by nixos-generate-config
│   └── pc/
│       ├── default.nix      # PC-specific system config
│       └── hardware-configuration.nix  # Generated by nixos-generate-config
├── modules/                 # Reusable NixOS modules
│   ├── common.nix          # Common system configuration
│   ├── desktop-i3.nix      # Desktop environment (i3wm)
│   ├── laptop.nix          # Laptop-specific features (TLP, touchpad, WiFi)
│   └── server.nix          # Server/headless configuration
├── home/                   # Home Manager configurations
│   ├── common.nix          # Common user configuration
│   └── users/
│       ├── dat-laptop.nix  # User config for laptop (with HiDPI scaling)
│       └── dat-pc.nix      # User config for PC (standard scaling)
└── assets/                 # Configuration files and assets
    ├── backgrounds/        # Wallpapers
    ├── config/            # Original config files
    ├── config-laptop/     # Laptop-specific configs (HiDPI)
    ├── config-pc/         # PC-specific configs (standard)
    └── script/            # Utility scripts
```

## Device Differences

### Laptop Configuration
- **Display**: HiDPI scaling enabled (1.4x scale factor)
- **Power Management**: TLP enabled for battery optimization
- **Hardware**: WiFi, Bluetooth, touchpad, brightness control
- **Services**: Thermal management, battery monitoring

### PC Configuration
- **Display**: Standard scaling (1x scale factor)
- **Power Management**: No TLP, performance-focused
- **Hardware**: Ethernet preferred, Bluetooth for peripherals, no touchpad
- **Services**: Hardware monitoring tools, stress testing utilities

## Usage

### Building for Laptop
```bash
sudo nixos-rebuild switch --flake /etc/nixos#laptop
```

### Building for PC
```bash
sudo nixos-rebuild switch --flake /etc/nixos#pc
```

## Setting up a New Host

### For PC Setup:
1. Install NixOS on your PC hardware
2. Generate hardware configuration:
   ```bash
   sudo nixos-generate-config --root /mnt --dir /etc/nixos/hosts/pc
   ```
3. Replace the placeholder `hardware-configuration.nix` with the generated one
4. Update `/etc/nixos/hosts/pc/hardware-configuration.nix` with actual UUIDs and hardware details
5. Build the configuration:
   ```bash
   sudo nixos-rebuild switch --flake /etc/nixos#pc
   ```

### Customization

#### Display Scaling
- **Laptop**: Modify scaling factors in `/etc/nixos/hosts/laptop/default.nix`
- **PC**: Standard scaling in `/etc/nixos/hosts/pc/default.nix`

#### Device-Specific Configs
- **Laptop configs**: `/etc/nixos/assets/config-laptop/`
- **PC configs**: `/etc/nixos/assets/config-pc/`

#### Adding New Hosts
1. Create new directory in `hosts/`
2. Add `default.nix` and `hardware-configuration.nix`
3. Create corresponding home configuration in `home/users/`
4. Update `flake.nix` to include the new host
5. Create device-specific config directory in `assets/`

## Modules Overview

- **common.nix**: Base system configuration (networking, users, packages)
- **desktop-i3.nix**: i3 window manager and desktop environment
- **laptop.nix**: Laptop-specific features (power management, hardware support)
- **server.nix**: Headless/server configuration

## Home Manager

Home Manager is integrated as a NixOS module and manages:
- User-specific packages and configurations
- Dotfiles and application configs
- Device-specific scaling and environment variables
- Desktop-specific applications and tools

## Key Bindings Reference

### Core i3 Keybindings ($mod = Super/Windows key)

#### Basic Window Management
- `$mod + Return` - Open terminal (Ghostty)
- `$mod + Shift + q` - Kill focused window
- `$mod + f` - Toggle fullscreen
- `$mod + Shift + space` - Toggle floating/tiling
- `$mod + space` - Switch focus between tiling/floating windows

#### Window Navigation & Movement
- `$mod + h/j/k/l` - Focus left/down/up/right (vim keys)
- `$mod + Arrow Keys` - Focus in direction
- `$mod + Shift + h/j/k/l` - Move window left/down/up/right
- `$mod + Shift + Arrow Keys` - Move window in direction

#### Layout Management
- `$mod + s` - Stacking layout
- `$mod + w` - Tabbed layout
- `$mod + e` - Toggle split layout
- `$mod + q` - Toggle split orientation
- `$mod + Ctrl + h` - Split horizontally
- `$mod + Ctrl + v` - Split vertically

#### Workspace Management
- `$mod + 1-8` - Switch to workspace 1-8
- `$mod + Ctrl + 1-8` - Move container to workspace 1-8
- `$mod + Shift + 1-8` - Move container to workspace and follow
- `$mod + b` - Switch to previous workspace
- `$mod + ]` - Next workspace
- `$mod + [` - Previous workspace

#### Application Launchers
- `$mod + d` - Application launcher (rofi drun)
- `$mod + x` - Command runner (rofi run)
- `$mod + period` - Emoji picker (rofi emoji)
- `$mod + t` - Window switcher (rofi window)
- `$mod + v` - Clipboard manager (greenclip)

#### Quick Application Access
- `$mod + F1` - Open Firefox with Google Calendar
- `$mod + F2` - Open file manager (pcmanfm)

#### Notifications (Dunst)
- `$mod + `` ` (backtick) - Close current notification
- `$mod + Shift + `` ` - Close all notifications
- `$mod + Ctrl + `` ` - Pop notification from history
- `$mod + Ctrl + Shift + `` ` - Trigger notification action
- `$mod + Shift + n` - Open notification history browser
- `$mod + Shift + d` - Restart dunst

#### Screenshots (Flameshot)
- `Print` - Capture screen to ~/Pictures/screenshots/
- `$mod + Print` - Interactive screenshot (GUI)
- `$mod + Shift + Print` - Full screen screenshot

#### System Controls
- `$mod + 0` - System menu (lock, logout, reboot, shutdown)
- `$mod + Ctrl + r` - Reload i3 config
- `$mod + Shift + r` - Restart i3
- `$mod + Ctrl + x` - Kill window (xkill)

#### Borders & Appearance
- `$mod + u` - Remove window borders
- `$mod + y` - Pixel borders (2px)
- `$mod + n` - Normal borders with title bar

#### Gaps Management
- `$mod + g` - Enter gaps mode
  - `o` - Outer gaps mode
  - `i` - Inner gaps mode
  - `+/-` - Increase/decrease gaps
  - `0` - Remove gaps

#### Resize Mode
- `$mod + r` - Enter resize mode
  - `h/j/k/l` - Resize with vim keys (5px)
  - `Arrow Keys` - Resize with arrows (20px)
  - `Return/Escape` - Exit resize mode

#### Scratchpad
- `$mod + Shift + -` - Move window to scratchpad
- `$mod + -` - Show/hide scratchpad

#### Hardware Keys (Laptop)
- `XF86AudioRaiseVolume/LowerVolume` - Volume up/down
- `XF86AudioMute` - Toggle mute
- `XF86MonBrightnessUp/Down` - Brightness up/down
- `XF86AudioPlay/Next/Prev/Stop` - Media controls

#### Miscellaneous
- `$mod + a` - Focus parent container
- `$mod + z` - Toggle input method (fcitx5)
- `$mod + Ctrl + b` - Open Bluetooth manager
- `$mod + Shift + w` - Change wallpaper
- `$mod + Shift + s` - Toggle sticky window
- `Caps_Lock` - Show CapsLock notification

### Shell Aliases (ZSH)
- `ll` / `la` - List files with details (`ls -la`)
- `gdrive` - Launch rclone manager script
- `z <pattern>` - Zoxide smart directory jumping
- `vi` / `vim` - Launch neovim

### Terminal Navigation
- `z <directory>` - Jump to directory using zoxide
- `zi <pattern>` - Interactive directory selection with zoxide

## Migration Notes

This setup migrates from a single-host configuration to a multi-host setup while maintaining backward compatibility through the `nixos` host alias.
